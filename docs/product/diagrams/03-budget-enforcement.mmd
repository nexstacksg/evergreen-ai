flowchart TD
    A([Place Order<br/>Amount: $X]) --> B{Individual<br/>Budget Set?}
    B -->|No| D{Company<br/>Budget Set?}
    B -->|Yes| C{Spent + $X ‚â§<br/>Individual Limit?}
    C -->|No| E[‚ùå BLOCKED<br/><i>Individual budget exceeded</i>]
    C -->|Yes| D
    D -->|No| G[‚úÖ ORDER APPROVED<br/><i>No budget constraints</i>]
    D -->|Yes| F{Company Spent + $X ‚â§<br/>Company Limit?}
    F -->|No| H[‚ùå BLOCKED<br/><i>Company budget exceeded</i>]
    F -->|Yes| I[üîí Lock Budget Row<br/><i>Prevent race condition</i>]
    I --> J[‚úÖ ORDER APPROVED]
    J --> K[Update Individual Spend]
    J --> L[Update Company Spend]

    style A fill:#FF9800,color:#fff
    style G fill:#4CAF50,color:#fff
    style J fill:#4CAF50,color:#fff
    style E fill:#f44336,color:#fff
    style H fill:#f44336,color:#fff
    style I fill:#9C27B0,color:#fff
